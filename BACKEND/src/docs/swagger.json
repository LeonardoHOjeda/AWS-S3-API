{
  "openapi": "3.0.3",
  "info": {
    "title": "Swagger AWS - Documentation",
    "description": "Esta es la documentación de la API de Swagger AWS donde se puede ver la información de los endpoints y los modelos de datos que se utilizan en la API asi como tambien conocer la estructura de los endpoints y los parametros que se utilizan en cada uno de ellos.", 
    "version": "1.0.14"
  },
  "servers": [
    {
      "url": "http://localhost:8000/api",
      "description": "Local server"
    },
    {
      "url": "https://apiaws.gobdigital.com/api",
      "description": "Production server"
    }
  ],
  "tags": [
    {
      "name": "Tenant",
      "description": "Todo acerca de los tenants"
    },
    {
      "name": "Archivos",
      "description": "Accede a los archivos de la base de datos"
    },
    {
      "name": "AWS",
      "description": "Archivos que se encuentran en AWS"
    }
  ],
  "paths": {
    "/tenants": {
      "get": {
        "tags": [
          "Tenant"
        ],
        "summary": "Obtener una lista de los tenants",
        "description": "Obtener una lista de los tenants guardados en la base de datos",
        "operationId": "getTenant",
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "integer",
                        "example": 1
                      },
                      "uuid": {
                        "type": "string",
                        "example": "48Umr3CjYAKXNTnYjZJipn"
                      },
                      "nombre": {
                        "type": "string",
                        "example": "NomiFacil_014"
                      },
                      "presignedURLTime": {
                        "type": "integer",
                        "example": 3000
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Tenant"],
        "summary": "Obtener una lista de los tenants",
        "description": "Obtener una lista de los tenants guardados en la base de datos",
        "operationId": "createTenant",
        "parameters": [
          {
            "name": "nombre",
            "in": "body",
            "description": "Nombre que se le va a asignar al Tenant",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "nombre": {
                  "type": "string",
                  "example": "NomiFacil_Euro_Preproduccion"
                }
              }
            }
          }
        ]
      }
    },
    "/tenants/{tenantUUID}": {
      "get": {
        "tags": [
          "Tenant"
        ],
        "summary": "Obtener un tenant por su UUID",
        "description": "Obtener un tenant por su UUID guardado en la base de datos",
        "operationId": "getTenantByUUID",
        "parameters": [
          {
            "name": "tenantUUID",
            "in": "path",
            "description": "UUID del tenant que se quiere obtener",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "example": {
                  "id": 1,
                  "uuid": "oo58dJPPYbhRAEj7mxtXCo",
                  "nombre": "Nomifacil_014",
                  "presignedURLTime": 3000
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "integer"
                    },
                    "uuid": {
                      "type": "string"
                    },
                    "nombre": {
                      "type": "string"
                    },
                    "presignedURLTime": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Tenant no encontrado",
            "content": {
              "application/json": {
                "example": {
                  "statusCode": 404,
                  "message": "Tenant no encontrado (AWS)"
                },
                "schema": {
                  "type": "object",
                  "properties": {
                    "statusCode": {
                      "type": "integer"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Tenant"],
        "summary": "Actualizar un tenant por su UUID",
        "description": "Actualizar un tenant con su UUID",
        "operationId": "updateTenantByUUID",
        "parameters": [
          {
            "name": "nombre",
            "in": "body",
            "description": "Nombre que se le va a asignar al Tenant",
            "required": false,
            "schema": {
              "type": "string",
              "properties": {
                "nombre": {
                  "type": "string",
                  "example": "NomiFacil_Euro_Updated"
                }
              }
            }
          },
          {
            "name": "presignedURLTime",
            "in": "body",
            "description": "Tiempo de expiración de la URL",
            "required": false,
            "schema": {
              "type": "number",
              "properties": {
                "presignedURLTime": {
                  "type": "integer",
                  "example": 5000
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Consulta exitosa",
            "content": {
              "application/json": {
                "example": {
                  "id": 1,
                  "uuid": "oo58dJPPYbhRAEj7mxtXCo",
                  "nombre": "NomiFacil_Euro_Updated",
                  "presignedURLTime": 5000
                }
              }
            }
          },
          "404": {
            "description": "Tenant no encontrado",
            "content": {
              "application/json": {
                "example": {
                  "statusCode": 404,
                  "message": "Tenant no encontrado (AWS)"
                }
              }
            }
          }
        }
      }
    },
    "/aws": {
      "get": {
        "tags": [
          "AWS"
        ],
        "summary": "Obtener un arreglo de todos los archivos",
        "description": "Obtener todos los archivos del bucket de AWS S3",
        "operationId": "getAWS",
        "responses": {
          "200": {
            "description": "Successful operation",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "Key": {
                        "type": "string",
                        "example": "Nomifácil_018/041f23f6-aa03-4c1c-97cc-e772582eb809.pdf"
                      },
                      "LastModified": {
                        "type": "string",
                        "example": "2023-08-30T18:25:35.000Z"
                      },
                      "ETag": {
                        "type": "string",
                        "example": "\"634730e988d5366c4251c3a6046ec40b\""
                      },
                      "Size": {
                        "type": "integer",
                        "example": 394538
                      },
                      "StorageClass": {
                        "type": "string",
                        "example": "STANDARD"
                      },
                      "Owner": {
                        "type": "object",
                        "properties": {
                          "DisplayName": {
                            "type": "string",
                            "example": "leoprogramador20"
                          },
                          "ID": {
                            "type": "string",
                            "example": "6582705bc67e54e92080d6dcc3a7729d0a4a8ecb0288d51acfd9304bf6035cec"
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "data": [
              {
                "Key": "Nomifácil_018/041f23f6-aa03-4c1c-97cc-e772582eb809.pdf",
                "LastModified": "2023-08-30T18:25:35.000Z",
                "ETag": "\"634730e988d5366c4251c3a6046ec40b\"",
                "Size": 394538,
                "StorageClass": "STANDARD",
                "Owner": {
                  "DisplayName": "leoprogramador20",
                  "ID": "6582705bc67e54e92080d6dcc3a7729d0a4a8ecb0288d51acfd9304bf6035cec"
                }
              }
            ]
          }
        }
      },
      "post": {
        "tags": ["AWS"],
        "summary": "Subir un archivo",
        "description": "Subir un archivo al bucket de AWS S3",
        "operationId": "uploadFileAWS",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Operacion exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "$metadata": {
                      "type": "object",
                      "properties": {
                        "httpStatusCode": {
                          "type": "integer",
                          "example": 200
                        },
                        "requestId": {
                          "type": "string",
                          "example": "KXCK0Y9WA7HEK0MP"
                        },
                        "extendedRequestId": {
                          "type": "string",
                          "example": "uFDUYlidQKGTL9tj4QMXkQxIE87hPsdaP/13g0E7weViEakUMcajUTsCjBbFFU0dEcVGkZC8osU="
                        },
                        "attempts": {
                          "type": "integer",
                          "example": 1
                        },
                        "totalRetryDelay": {
                          "type": "integer",
                          "example": 0
                        }
                      }
                    },
                    "ETag": {
                      "type": "string",
                      "example": "\"9f4ca6fbfb900d6e3fcfdc49d228bb08\""
                    },
                    "ServerSideEncryption": {
                      "type": "string",
                      "example": "AES256"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al subir el archivo",
            "content": {
              "application/json": {
                "example": {
                  "statusCode": 500,
                  "message": "Internal Server Error"
                }
              }
            }
          }
        }        
      }    
    },
    "/aws/{folder}/{fileName}": {
      "get": {
        "tags": ["AWS"],
        "summary": "Obtener un tenant por su UUID",
        "description": "Obtener un tenant por su UUID guardado en la base de datos",
        "operationId": "getFileByUUID",
        "parameters": [
          {
            "name": "folder",
            "in": "path",
            "description": "Nombre del folder donde se encuentra el archivo",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "fileName",
            "in": "path",
            "description": "Nombre del archivo",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Operacion exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "httpStatusCode": {
                      "type": "integer",
                      "example": 200
                    },
                    "requestId": {
                      "type": "string",
                      "example": "2KM4HGJV41W2RFJ0"
                    },
                    "extendedRequestId": {
                      "type": "string",
                      "example": "TaUWvgdtAsVAmAAKMOQ9eULdOggM0GDdnMpi51QuVR+yjzVM1e68drIpQy7CcuwSBu1nMK242b0="
                    },
                    "attempts": {
                      "type": "integer",
                      "example": 1
                    },
                    "totalRetryDelay": {
                      "type": "integer",
                      "example": 0
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Error al obtener un archivo cuya KEY no existe",
            "content": {
              "application/json": {
                "example": {
                  "statusCode": 404,
                  "message": "No se encontró el archivo"
                }
              }
            }
          }
        }        
      },
      "delete": {
        "tags": ["AWS"],
        "summary": "Eliminar un archivo",
        "description": "Eliminar un archivo del bucket de AWS S3 por su nombre y carpeta",
        "operationId": "deleteAWSFile",
        "parameters": [
          {
            "name": "folder",
            "in": "path",
            "description": "Nombre del folder donde se encuentra el archivo",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "fileName",
            "in": "path",
            "description": "Nombre del archivo",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Archivo eliminado con éxito",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "$metadata": {
                      "type": "object",
                      "properties": {
                        "httpStatusCode": {
                          "type": "integer",
                          "example": 204
                        },
                        "requestId": {
                          "type": "string",
                          "example": "VD0WWTHS724TASXR"
                        },
                        "extendedRequestId": {
                          "type": "string",
                          "example": "ny7k8rmRjH6FBYxHVPuxIJrfBX/u0bRvzQhfYqOWnPD/1AZvp+PLCx3JEX+gnzzmfQfI0T8njAg="
                        },
                        "attempts": {
                          "type": "integer",
                          "example": 1
                        },
                        "totalRetryDelay": {
                          "type": "integer",
                          "example": 0
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
        
      }
    },
    "/aws/download/{folder}/{fileName}": {
      "get": {
        "tags": ["AWS"],
        "summary": "Descargar un archivo",
        "description": "Descargar un archivo del bucket por su UUID",
        "operationId": "downloadFileByUUID",
        "parameters": [
          {
            "name": "folder",
            "in": "path",
            "description": "Nombre del folder donde se encuentra el archivo",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "fileName",
            "in": "path",
            "description": "Nombre del archivo",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Operacion exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Archivo descargado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error al intentar descargar un archivo cuya KEY no existe",
            "content": {
              "application/json": {
                "example": {
                  "statusCode": 404,
                  "message": "No se encontró el archivo"
                }
              }
            }
          }
        }  
      }
    }
  },
  "components": {
    "schemas": {
      "Tenant": {
        "required": [
          "nombre",
          "photoUrls"
        ],
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "uuid": {
            "type": "string",
            "example": "48Umr3CjYAKXNTnYjZJipn"
          },
          "nombre": {
            "type": "string",
            "example": "Nomifacil_007"
          },
          "presignedURLTime": {
            "type": "number",
            "example": 3000
          }
        },
        "xml": {
          "name": "pet"
        }
      },
      "Archivo": {
        "required": [
          "nombreArchivo",
          "tenantUuid"
        ],
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "example": 1
          },
          "uuid": {
            "type": "string",
            "example": "cda348be-9bff-4612-8aed-afe527c5b36f"
          },
          "nombreArchivo": {
            "type": "string",
            "example": "Justificante K11-230529_191218.pdf"
          },
          "awsObjectKey": {
            "type": "string",
            "example": "NomiFacil_014/cda348be-9bff-4612-8aed-afe527c5b36f.pdf"
          },
          "awsBucket": {
            "type": "string",
            "example": "nf_repo_nomifacil"
          },
          "awsRegion": {
            "type": "string",
            "example": "us-east-1"
          },
          "createdAt": {
            "type": "string",
            "example": "2023-07-27T18:06:19.440Z"
          },
          "tenantUuid": {
            "$ref": "#/components/schemas/Tenant"
          }
        },
        "xml": {
          "name": "pet"
        }
      },
      "ApiResponse": {
        "type": "object",
        "properties": {
          "code": {
            "type": "integer",
            "format": "int32"
          },
          "type": {
            "type": "string"
          },
          "message": {
            "type": "string"
          }
        },
        "xml": {
          "name": "##default"
        }
      }
    },
    "requestBodies": {
      "Pet": {
        "description": "Pet object that needs to be added to the store",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/Pet"
            }
          },
          "application/xml": {
            "schema": {
              "$ref": "#/components/schemas/Pet"
            }
          }
        }
      },
      "UserArray": {
        "description": "List of user object",
        "content": {
          "application/json": {
            "schema": {
              "type": "array",
              "items": {
                "$ref": "#/components/schemas/User"
              }
            }
          }
        }
      }
    },
    "securitySchemes": {
      "petstore_auth": {
        "type": "oauth2",
        "flows": {
          "implicit": {
            "authorizationUrl": "https://petstore3.swagger.io/oauth/authorize",
            "scopes": {
              "write:pets": "modify pets in your account",
              "read:pets": "read your pets"
            }
          }
        }
      },
      "api_key": {
        "type": "apiKey",
        "name": "api_key",
        "in": "header"
      }
    }
  }
}